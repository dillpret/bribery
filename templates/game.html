<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="game-id" content="{{ game_id }}">
    <title>Bribery Game - {{ game_id }}</title>
    <link rel="stylesheet" href="/static/css/game.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Bribery</h1>
            <div class="game-info">
                Game ID: <strong>{{ game_id }}</strong>
            </div>
        </div>

        <div class="status-bar">
            <div id="game-status">Connecting...</div>
            <div id="timer" class="timer hidden"></div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby" class="hidden">
            <div class="lobby-content">
                <h2>Waiting for Players</h2>
                <div class="player-list" id="player-list"></div>
                <div class="settings-display" id="settings-display"></div>
                
                <!-- Host Settings Controls (only visible to host) -->
                <div id="host-settings" class="hidden">
                    <h3>Game Settings</h3>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label for="rounds">Number of Rounds:</label>
                            <select id="rounds">
                                <option value="3">3 Rounds</option>
                                <option value="5">5 Rounds</option>
                                <option value="7">7 Rounds</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="submission-time-mode">Submission Time:</label>
                            <div class="time-input-container">
                                <select id="submission-time-mode">
                                    <option value="off">Off - Wait for all players</option>
                                    <option value="timed">Timed</option>
                                </select>
                                <div id="submission-time-controls" class="time-controls hidden">
                                    <input type="number" id="submission-time-value" min="1" max="999" value="2" placeholder="2">
                                    <select id="submission-time-unit">
                                        <option value="minutes">Minutes</option>
                                        <option value="seconds">Seconds</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="voting-time-mode">Voting Time:</label>
                            <div class="time-input-container">
                                <select id="voting-time-mode">
                                    <option value="off">Off - Wait for all players</option>
                                    <option value="timed">Timed</option>
                                </select>
                                <div id="voting-time-controls" class="time-controls hidden">
                                    <input type="number" id="voting-time-value" min="1" max="999" value="60" placeholder="60">
                                    <select id="voting-time-unit">
                                        <option value="seconds">Seconds</option>
                                        <option value="minutes">Minutes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="results-time-mode">Results Screen Time:</label>
                            <div class="time-input-container">
                                <select id="results-time-mode">
                                    <option value="off">Off - Host controls next round</option>
                                    <option value="timed">Timed</option>
                                </select>
                                <div id="results-time-controls" class="time-controls hidden">
                                    <input type="number" id="results-time-value" min="1" max="999" value="15" placeholder="15">
                                    <select id="results-time-unit">
                                        <option value="seconds">Seconds</option>
                                        <option value="minutes">Minutes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="custom-prompts">Custom Prompts:</label>
                            <select id="custom-prompts">
                                <option value="true">Enabled - Each player chooses their own</option>
                                <option value="false">Disabled - Same prompt for all</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="updateSettings()" class="settings-update-btn">Update Settings</button>
                </div>
                
                <div id="host-controls" class="hidden">
                    <button id="start-game-btn" onclick="startGame()" disabled>Start Game</button>
                </div>
                <p style="margin-top: 20px; color: #666;">
                    Share the Game ID <strong>{{ game_id }}</strong> with your friends to join!
                </p>
            </div>
        </div>

        <!-- Prompt Selection Phase -->
        <div id="prompt-selection" class="hidden">
            <div class="prompt-selection-content">
                <h2 id="prompt-round-title"></h2>
                <p class="instruction">Choose the prompt that other players will use when bribing you:</p>

                <div class="prompt-selector">
                    <div class="prompt-option-section">
                        <h3>Choose from suggested prompts:</h3>
                        <select id="prompt-dropdown" onchange="onPromptDropdownChange()">
                            <option value="">Select a prompt...</option>
                        </select>
                    </div>

                    <div class="prompt-divider">
                        <span>OR</span>
                    </div>

                    <div class="prompt-option-section">
                        <h3>Type your own custom prompt:</h3>
                        <textarea id="custom-prompt-input" placeholder="Enter your custom prompt here..."
                            maxlength="200"></textarea>
                    </div>

                    <button id="confirm-prompt-btn" onclick="selectPrompt()" disabled>
                        Confirm Prompt
                    </button>
                </div>

                <div class="help-text">
                    <p><strong>Tip:</strong> Choose a prompt that will inspire creative and funny bribes!</p>
                </div>
            </div>
        </div>

        <!-- Submission Phase -->
        <div id="submission-phase" class="hidden">
            <div class="round-info">
                <h2 id="round-title"></h2>
                <div class="prompt" id="current-prompt"></div>
                <div id="submission-progress" class="progress-indicator">
                    <p id="submission-progress-text">0/0 players finished</p>
                </div>
            </div>
            <div id="targets-container"></div>
        </div>

        <!-- Voting Phase -->
        <div id="voting-phase" class="hidden">
            <div class="voting-content">
                <h2>Time to Vote!</h2>
                <div id="voting-progress" class="progress-indicator">
                    <p id="voting-progress-text">0/0 players voted</p>
                </div>
                <div class="player-prompt-container">
                    <h3>Your prompt was:</h3>
                    <div id="voting-player-prompt" class="player-prompt"></div>
                </div>
                <p>Choose your favourite bribe submission:</p>
                <div id="voting-options"></div>
                <button id="submit-vote-btn" onclick="submitVote()" disabled>Submit Vote</button>
            </div>
        </div>

        <!-- Scoreboard -->
        <div id="scoreboard-phase" class="hidden">
            <div class="round-info">
                <h2 id="scoreboard-title"></h2>
                <p class="round-subtitle">See who won each prompt and their winning bribes below!</p>
            </div>
            <div id="vote-results" class="vote-results hidden"></div>
            <div class="scoreboard" id="scoreboard"></div>
        </div>

        <!-- Final Results -->
        <div id="final-results" class="hidden">
            <div class="round-info">
                <h2>üèÜ Final Results üèÜ</h2>
            </div>
            <div class="scoreboard" id="final-scoreboard"></div>
            <div id="host-final-controls" class="hidden">
                <button onclick="returnToLobby()" class="primary-button">Return to Lobby</button>
                <button onclick="restartGame()">Play Again</button>
                <button onclick="window.location.href='/'">New Game</button>
            </div>
        </div>

        <!-- Waiting Screen -->
        <div id="waiting-screen" class="hidden">
            <div class="waiting-screen">
                <div class="waiting-spinner"></div>
                <h2>Waiting for the next round...</h2>
                <p>You'll be added to the game when the next round starts!</p>
            </div>
        </div>
    </div>

    <!-- Player List Panel -->
    <button class="player-list-toggle" id="player-list-toggle">üë•</button>
    <div id="player-list-panel" class="player-list-panel">
        <h2>Players & Scores</h2>
        <ul id="player-score-list" class="player-score-list">
            <!-- Player list will be populated here -->
        </ul>
    </div>

    <!-- Kick Player Confirmation Modal -->
    <div id="confirmation-modal-overlay" class="modal-overlay">
        <div class="confirmation-modal">
            <h3>Kick Player?</h3>
            <p id="kick-confirmation-message">Are you sure you want to kick this player?</p>
            <div class="modal-buttons">
                <button id="confirm-kick" class="confirm-kick">Yes, Kick Player</button>
                <button id="cancel-kick" class="cancel-kick">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/static/socket.io.min.js"></script>
    <script src="/static/js/game-state.js"></script>
    <script src="/static/js/game-core.js"></script>
    <script src="/static/js/socket-handlers.js"></script>
    <script src="/static/js/ui-handlers.js"></script>
    <script src="/static/js/player-list-panel.js"></script>
</body>

</html>